# Microsoft Graph Detection Rules Test Application Configuration
# Copy this file to .env and fill in your Azure AD application details

# ============================================================================
# AZURE AD APPLICATION CONFIGURATION (REQUIRED)
# ============================================================================

# Azure AD Application (Client) ID
# Get this from your app registration in the Azure portal
AZURE_CLIENT_ID=your app ip here

# Azure AD Application Client Secret
# Generate this in your app registration under "Certificates & secrets"
AZURE_CLIENT_SECRET=app secret here

# Azure AD Tenant ID
# This is your organization's tenant ID (Directory ID in Azure portal)
AZURE_TENANT_ID=your tenant here

# ============================================================================
# MICROSOFT GRAPH API CONFIGURATION (OPTIONAL)
# ============================================================================

# Microsoft Graph API Base URL
# Default is the beta endpoint for detection rules
GRAPH_API_BASE_URL=https://graph.microsoft.com/beta

# Azure AD Authority URL (automatically constructed if not provided)
# AZURE_AUTHORITY_URL=https://login.microsoftonline.com/your-tenant-id

# Microsoft Graph API Scopes (comma-separated)
# Default scope for detection rules management
GRAPH_SCOPES=https://graph.microsoft.com/CustomDetection.ReadWrite.All

# ============================================================================
# MICROSOFT SENTINEL CONFIGURATION (OPTIONAL)
# ============================================================================

# Azure Subscription ID (required for Sentinel analytics rules)
# AZURE_SUBSCRIPTION_ID=your-subscription-id-here

# Azure Resource Group containing your Sentinel workspace
# AZURE_RESOURCE_GROUP=your-resource-group-here

# Microsoft Sentinel Workspace Name
# SENTINEL_WORKSPACE_NAME=your-sentinel-workspace-here

# Azure Management API Base URL
AZURE_MANAGEMENT_BASE_URL=https://management.azure.com

# Azure Management API Scopes
AZURE_MANAGEMENT_SCOPES=https://management.azure.com/.default

# ============================================================================
# APPLICATION CONFIGURATION (OPTIONAL)
# ============================================================================

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Custom log format
# LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# HTTP request timeout in seconds
REQUEST_TIMEOUT=30

# Maximum number of retry attempts for failed requests
MAX_RETRIES=3

# Delay between retry attempts in seconds
RETRY_DELAY=1.0

# Application name and version
APP_NAME=Graph Security Detection Rules Test
APP_VERSION=1.0.0

# Prefix for test detection rules (for easy identification and cleanup)
TEST_RULE_PREFIX=TEST_RULE_

# ============================================================================
# SETUP INSTRUCTIONS
# ============================================================================

# 1. Azure AD App Registration:
#    - Go to Azure Portal > Azure Active Directory > App registrations
#    - Click "New registration"
#    - Name: "Graph Detection Rules Test App"
#    - Supported account types: "Accounts in this organizational directory only"
#    - Redirect URI: Not required for this app
#    - Click "Register"

# 2. Configure API Permissions:
#    - In your app registration, go to "API permissions"
#    - Click "Add a permission" > "Microsoft Graph" > "Application permissions"
#    - Search for and add: "CustomDetection.ReadWrite.All"
#    - Click "Grant admin consent for [your organization]"

# 3. Create Client Secret:
#    - In your app registration, go to "Certificates & secrets"
#    - Click "New client secret"
#    - Description: "Detection Rules Test Secret"
#    - Expires: Choose appropriate duration (12 months recommended)
#    - Click "Add" and copy the secret value immediately

# 4. Get Required IDs:
#    - Client ID: Available on the app registration "Overview" page
#    - Tenant ID: Available on the app registration "Overview" page or 
#                 Azure AD "Overview" page (Directory ID)

# 5. Update This File:
#    - Copy this file to .env
#    - Replace all "your-*-here" values with actual values from steps above
#    - Ensure the .env file is in the same directory as main.py

# 6. Test Your Configuration:
#    - Run: python main.py config
#    - Run: python main.py health

# ============================================================================
# SECURITY NOTES
# ============================================================================

# - Never commit the .env file to version control
# - Keep your client secret secure and rotate it regularly  
# - Use the principle of least privilege for API permissions
# - Monitor your app's usage in the Azure portal
# - Consider using certificate-based authentication for production

# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# Common Issues:

# 1. "Configuration validation failed"
#    - Check all required environment variables are set
#    - Verify client ID and tenant ID format (should be GUIDs)

# 2. "Authentication failed" 
#    - Verify client secret is correct and not expired
#    - Check tenant ID is correct
#    - Ensure app registration is in the correct tenant

# 3. "Insufficient permissions"
#    - Verify CustomDetection.ReadWrite.All permission is granted
#    - Ensure admin consent has been granted
#    - Check the app has application permissions (not delegated)

# 4. "API access failed"
#    - Check internet connectivity
#    - Verify Graph API base URL is correct
#    - Ensure your organization allows Graph API access

# For more help, check the application logs or run with --verbose flag
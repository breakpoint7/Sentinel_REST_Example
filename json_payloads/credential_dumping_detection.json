{
  "displayName": "TEST_RULE_Credential_Dumping_Detection",
  "isEnabled": true,
  "queryCondition": {
    "queryText": "DeviceProcessEvents\n| where Timestamp > ago(1h)\n| where ProcessCommandLine contains \"lsass\" \n   or ProcessCommandLine contains \"sekurlsa\"\n   or ProcessCommandLine contains \"mimikatz\"\n   or ProcessCommandLine contains \"procdump\"\n   or FileName in (\"mimikatz.exe\", \"procdump.exe\", \"rundll32.exe\")\n| where ProcessCommandLine contains \"lsass.exe\" or ProcessCommandLine contains \"memory\"\n| project Timestamp, DeviceName, FileName, ProcessCommandLine, InitiatingProcessFileName, DeviceId, ReportId"
  },
  "schedule": {
    "period": "1H"
  },
  "detectionAction": {
    "alertTemplate": {
      "title": "Potential Credential Dumping Activity",
      "description": "Activity consistent with credential dumping was detected. This may indicate \nan attempt to extract credentials from memory, which is commonly used by \nattackers to escalate privileges or move laterally in the network.",
      "severity": "high",
      "category": "CredentialAccess",
      "mitreTechniques": [
        "T1003.001",
        "T1003.002"
      ],
      "impactedAssets": [
        {
          "@odata.type": "#microsoft.graph.security.impactedDeviceAsset",
          "identifier": "deviceId"
        }
      ]
    },
    "responseActions": [
      {
        "@odata.type": "#microsoft.graph.security.isolateDeviceResponseAction",
        "identifier": "deviceId",
        "isolationType": "full"
      }
    ]
  }
}